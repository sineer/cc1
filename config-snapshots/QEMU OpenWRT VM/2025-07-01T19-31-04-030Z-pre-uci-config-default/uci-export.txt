package dhcp

config domain 'domain1'
	option name 'captive.owisp.org'
	option ip '10.0.0.1'

config dhcp 'lan'
	option dhcpv6 'server'
	option dhcpv4 'server'
	option ra_flags 'managed-config other-config'
	option limit '150'
	option start '100'
	option leasetime '24h'
	option ra 'server'
	option interface 'lan'

config domain 'captive_domain1'
	option name 'captive.local'
	option ip '10.0.0.1'

config odhcpd 'odhcpd'
	option leasetrigger '/usr/sbin/odhcpd-update'
	option loglevel '4'
	option maindhcp '0'
	option leasefile '/tmp/hosts/odhcpd'

config dnsmasq 'dnsmasq1'
	option readethers '1'
	option ednspacket_max '1232'
	option expandhosts '1'
	option boguspriv '1'
	option localise_queries '1'
	option localservice '1'
	option filterwin2k '0'
	option cachesize '1000'
	option nonwildcard '1'
	option resolvfile '/tmp/resolv.conf.d/resolv.conf.auto'
	option domainneeded '1'
	option domain 'lan'
	option filter_a '0'
	option rebind_protection '1'
	option filter_aaaa '0'
	option local '/lan/'
	option authoritative '1'
	option nonegcache '0'
	option rebind_localhost '1'
	option leasefile '/tmp/dhcp.leases'

config dhcp 'wan'
	option ignore '1'
	option leasetime '12h'
	option limit '150'
	option start '100'
	option interface 'wan'

config dhcp 'captive'
	option limit '1000'
	option start '2'
	option leasetime '2h'
	option interface 'captive'

package dropbear

config dropbear 'dropbear1'
	option GatewayPorts '1'
	option PasswordAuth 'on'
	option Port '22'
	option RootPasswordAuth 'on'

package firewall

config ipset 'captive_ipset2'
	option name 'wlist'
	option entry '10.0.0.1 10.8.0.1 10.0.0.1 10.8.0.1 10.0.0.1 10.8.0.1 10.0.0.1 10.8.0.1 10.0.0.1 10.8.0.1 10.0.0.1 10.8.0.1'
	option match 'dest_ip'

config rule 'captive_rule10'
	option dest_port '67 123'
	option name 'Allow-DHCP-NTP-captive'
	option target 'ACCEPT'
	option src 'captive'
	option proto 'udp'

config rule 'captive_rule14'
	option dest_port '53'
	option name 'Allow-DNS-captive'
	option target 'ACCEPT'
	option src 'captive'
	option proto 'udp tcp udp tcp udp tcp udp tcp udp tcp udp tcp'

config ipset 'captive_ipset1'
	option name 'uspot'
	option match 'src_mac'

config rule 'captive_rule11'
	option src 'captive'
	option name 'Restrict-input-captive'
	option target 'DROP'
	option dest_ip '!captive'

config rule 'captive_rule13'
	option src 'captive'
	option name 'Forward-auth-captive'
	option proto 'any'
	option target 'ACCEPT'
	option dest 'wan'
	option ipset 'uspot'

config zone 'cfg03dc81'
	option network 'lan'
	option output 'ACCEPT'
	option name 'lan'
	option input 'ACCEPT'
	option forward 'ACCEPT'

config rule 'captive_rule12'
	option dest_port '80 443 3990'
	option name 'Allow-captive-CPD-WEB-UAM'
	option target 'ACCEPT'
	option src 'captive'
	option proto 'tcp'

config defaults 'cfg01e63d'
	option input 'REJECT'
	option forward 'REJECT'
	option output 'REJECT'

config zone 'cfg10dc81'
	option network 'vpn'
	option output 'ACCEPT'
	option name 'vpn'
	option input 'ACCEPT'
	option forward 'ACCEPT'
	option masq '1'

config firewall 'cfg02b57b'

config redirect 'captive_redirect1'
	option src_dport '80'
	option reflection '0'
	option name 'Redirect-unauth-captive-CPD'
	option proto 'tcp'
	option ipset '!uspot'
	option src 'captive'
	option target 'DNAT'

config rule 'captive_rule15'
	option proto 'udp'
	option dest_port '3799'
	option name 'Allow-captive-DAE'
	option src_ip '10.0.0.1'
	option family 'ipv4'
	option src 'wan'
	option target 'ACCEPT'

config rule 'captive_rule16'
	option src 'captive'
	option name 'Allow-Whitelist'
	option proto 'any'
	option target 'ACCEPT'
	option dest 'wan'
	option ipset 'wlist'

config forwarding 'cfg11ad58'
	option src 'captive'
	option dest 'vpn'

config zone 'cfg04dc81'
	option network 'wan'
	option output 'ACCEPT'
	option name 'wan'
	option input 'REJECT'
	option forward 'ACCEPT'
	option masq '1'

config zone 'captive'
	option network 'captive'
	option output 'ACCEPT'
	option name 'captive'
	option input 'REJECT'
	option forward 'REJECT'

package luci

config core 'main'
	option lang 'auto'
	option mediaurlbase '/luci-static/bootstrap'
	option resourcebase '/luci-static/resources'
	option ubuspath '/ubus/'

config extern 'flash_keep'
	option uci '/etc/config/'
	option dropbear '/etc/dropbear/'
	option openvpn '/etc/openvpn/'
	option passwd '/etc/passwd'
	option opkg '/etc/opkg.conf'
	option firewall '/etc/firewall.user'
	option uploads '/lib/uci/upload/'

config internal 'languages'

config internal 'sauth'
	option sessionpath '/tmp/luci-sessions'
	option sessiontime '3600'

config internal 'ccache'
	option enable '1'

config internal 'themes'
	option Bootstrap '/luci-static/bootstrap'
	option BootstrapDark '/luci-static/bootstrap-dark'
	option BootstrapLight '/luci-static/bootstrap-light'

config internal 'apply'
	option rollback '90'
	option holdoff '4'
	option timeout '5'
	option display '1.5'

config internal 'diag'
	option dns 'openwrt.org'
	option ping 'openwrt.org'
	option route 'openwrt.org'

package network

config device 'device_eth2'
	option ipv6 '0'
	option name 'eth2'

config interface 'lan'
	option ipaddr '192.168.11.2'
	option device 'br-lan'
	option proto 'static'
	option netmask '255.255.255.0'
	option ip6assign '60'
	option dns '192.168.11.1'
	option gateway '192.168.11.1'

config device 'device_eth0'
	option ipv6 '0'
	option name 'eth0'

config interface 'vpn'
	option proto 'none'
	option device 'tun0'

config interface 'wan'
	option ipaddr '192.168.12.2'
	option device 'eth1'
	option proto 'static'
	option gateway '192.168.12.1'
	option dns '192.168.12.1'
	option netmask '255.255.255.0'

config globals 'globals'
	option ula_prefix 'fd9f:3767:c475::/48'

config interface 'loopback'
	option ipaddr '127.0.0.1'
	option device 'lo'
	option proto 'static'
	option netmask '255.0.0.0'

config device 'device_eth1'
	option ipv6 '0'
	option name 'eth1'

config device 'device_lan'
	option name 'br-lan'
	option ports 'eth0'
	option type 'bridge'

config interface 'captive'
	option dns '10.0.0.1'
	option netmask '255.255.252.0'
	option proto 'static'
	option ipaddr '10.0.0.1'
	option device 'eth2'

package openvpn

config openvpn 'default'
	option auth 'SHA1'
	option ca '/etc/x509/ca-1-OpenWISP.pem'
	option cert '/etc/x509/client-889c3f87f8c140b2a001cf2c2529c1b2.pem'
	option cipher 'none'
	option comp_lzo 'no'
	option dev 'tun0'
	option dev_type 'tun'
	option enabled '1'
	option fast_io '1'
	option float '0'
	option group 'nogroup'
	option keepalive '10 120'
	option key '/etc/x509/key-889c3f87f8c140b2a001cf2c2529c1b2.pem'
	option mode 'p2p'
	option mssfix '1450'
	option mtu_test '0'
	option mute '0'
	option mute_replay_warnings '0'
	option nobind '1'
	option persist_key '1'
	option persist_tun '1'
	option proto 'udp'
	option pull '1'
	option reneg_sec '0'
	option resolv_retry 'infinite'
	option script_security '2'
	option tls_client '1'
	option tls_timeout '2'
	option user 'nobody'
	option verb '3'
	list remote 'openvpn.o1.ubi.tel 1194'

package openvpn-opkg

config openvpn 'custom_config'
	option enabled '0'
	option config '/etc/openvpn/my-vpn.conf'

config openvpn 'sample_server'
	option enabled '0'
	option port '1194'
	option proto 'udp'
	option dev 'tun'
	option ca '/etc/openvpn/ca.crt'
	option cert '/etc/openvpn/server.crt'
	option key '/etc/openvpn/server.key'
	option dh '/etc/openvpn/dh2048.pem'
	option server '10.8.0.0 255.255.255.0'
	option ifconfig_pool_persist '/tmp/ipp.txt'
	option keepalive '10 120'
	option persist_key '1'
	option persist_tun '1'
	option user 'nobody'
	option status '/tmp/openvpn-status.log'
	option verb '3'

config openvpn 'sample_client'
	option enabled '0'
	option client '1'
	option dev 'tun'
	option proto 'udp'
	list remote 'my_server_1 1194'
	option resolv_retry 'infinite'
	option nobind '1'
	option persist_key '1'
	option persist_tun '1'
	option user 'nobody'
	option ca '/etc/openvpn/ca.crt'
	option cert '/etc/openvpn/client.crt'
	option key '/etc/openvpn/client.key'
	option verb '3'

package openwisp

config controller 'http'
	option url 'https://dashboard.o1.ubi.tel'
	option verify_ssl '0'
	option mac_interface 'br-lan'
	option management_interface 'tun0'
	option uuid '006df616fbdc4be8a23d738e913c8b14'
	option key 'c043f62e07daad2cf147bbe9ca107c5c'

package openwisp-monitoring

config monitoring 'monitoring'
	option monitored_interfaces '*'
	option interval '300'
	option verbose_mode '0'
	option required_memory '0.05'
	option max_retries '5'

package rpcd

config rpcd 'rpcd1'
	option socket '/var/run/ubus/ubus.sock'
	option timeout '30'

config login 'login1'
	option password '$p$root'
	list read '*'
	option username 'root'
	list write '*'

package socat

config socat 'http'
	option enable '0'
	option SocatOptions '-d -d TCP6-LISTEN:8000,fork TCP4:192.168.1.20:80'
	option user 'nobody'

package system

config system 'system'
	option hostname 'qemu-cowboy-demo'
	option log_size '64'
	option timezone 'UTC'
	option ttylogin '0'
	option urandom_seed '0'

config timeserver 'ntp'
	option enabled '1'
	option enable_server '0'
	list server '0.openwrt.pool.ntp.org'
	list server '1.openwrt.pool.ntp.org'
	list server '2.openwrt.pool.ntp.org'
	list server '3.openwrt.pool.ntp.org'

package ubispot

config ubispot 'captive'
	option das_port '3799'
	option disconnect_delay '0'
	option das_secret 'testing123'
	option idle_timeout '600'
	option interface 'captive'
	option auth_server '10.8.0.1'
	option debug '1'
	option session_timeout '0'
	option acct_port '1813'
	option auth_mode 'uam'
	option acct_server '10.8.0.1'
	option final_redirect_url 'uam'
	option setname 'uspot'
	option auth_port '1812'
	option auth_secret 'testing123'
	option acct_secret 'testing123'
	option uam_server 'http://10.8.0.1:8080'

package ubispot-opkg

config ubispot 'captive'
	option auth_mode 'uam'
	option idle_timeout '600'
	option session_timeout '0'
	option disconnect_delay '0'
	option interface 'captive'
	option setname 'uspot'
	option debug '1'
	option auth_server '10.8.0.1'
	option auth_port '1812'
	option auth_secret 'testing123'
	option acct_server '10.8.0.1'
	option acct_port '1813'
	option acct_secret 'testing123'
	option das_secret 'testing123'
	option uam_server 'http://10.8.0.1:8080'
	option final_redirect_url 'uam'

package ucitrack

config network 'network1'
	list affects 'dhcp'
	option init 'network'

config wireless 'wireless1'
	list affects 'network'

config firewall 'firewall1'
	list affects 'luci-splash'
	list affects 'qos'
	list affects 'miniupnpd'
	option init 'firewall'

config olsr 'olsr1'
	option init 'olsrd'

config dhcp 'dhcp1'
	list affects 'odhcpd'
	option init 'dnsmasq'

config odhcpd 'odhcpd1'
	option init 'odhcpd'

config dropbear 'dropbear2'
	option init 'dropbear'

config httpd 'httpd1'
	option init 'httpd'

config fstab 'fstab1'
	option exec '/sbin/block mount'

config qos 'qos1'
	option init 'qos'

config system 'system1'
	list affects 'luci_statistics'
	list affects 'dhcp'
	option exec '/etc/init.d/log reload'
	option init 'led'

config luci_splash 'luci_splash1'
	option init 'luci_splash'

config upnpd 'upnpd1'
	option init 'miniupnpd'

config ntpclient 'ntpclient1'
	option init 'ntpclient'

config samba 'samba1'
	option init 'samba'

config tinyproxy 'tinyproxy1'
	option init 'tinyproxy'

package uhttpd

config uhttpd 'main'
	option http_keepalive '20'
	option listen_https '0.0.0.0:443 [::]:443'
	option listen_http '192.168.11.2:8080'
	option network_timeout '30'
	option rfc1918_filter '1'
	option script_timeout '60'
	option redirect_https '0'
	option lua_prefix '/cgi-bin/luci=/usr/lib/lua/luci/sgi/uhttpd.lua'
	option max_connections '100'
	option cgi_prefix '/cgi-bin'
	option tcp_keepalive '1'
	option cert '/etc/uhttpd.crt'
	option home '/www'
	option max_requests '3'
	option key '/etc/uhttpd.key'
	option ubus_prefix '/ubus'

config cert 'defaults'
	option country 'ZZ'
	option commonname 'OpenWrt'
	option state 'Somewhere'
	option bits '2048'
	option key_type 'ec'
	option location 'Unknown'
	option ec_curve 'P-256'
	option days '730'

config uhttpd 'uam3990'
	option listen_http '0.0.0.0:3990'
	option home '/www-ubispot'
	option ucode_prefix '/logon=/usr/share/ubispot/handler-uam.uc /logoff=/usr/share/ubispot/handler-uam.uc /logout=/usr/share/ubispot/handler-uam.uc /logon=/usr/share/ubispot/handler-uam.uc /logoff=/usr/share/ubispot/handler-uam.uc /logout=/usr/share/ubispot/handler-uam.uc /logon=/usr/share/ubispot/handler-uam.uc /logoff=/usr/share/ubispot/handler-uam.uc /logout=/usr/share/ubispot/handler-uam.uc /logon=/usr/share/ubispot/handler-uam.uc /logoff=/usr/share/ubispot/handler-uam.uc /logout=/usr/share/ubispot/handler-uam.uc /logon=/usr/share/ubispot/handler-uam.uc /logoff=/usr/share/ubispot/handler-uam.uc /logout=/usr/share/ubispot/handler-uam.uc /logon=/usr/share/ubispot/handler-uam.uc /logoff=/usr/share/ubispot/handler-uam.uc /logout=/usr/share/ubispot/handler-uam.uc'
	option max_requests '5'
	option redirect_https '0'
	option no_dirlists '1'

config uhttpd 'ubispot'
	option listen_http '10.0.0.1:80'
	option no_dirlists '1'
	option home '/www-ubispot'
	option ucode_prefix '/hotspot=/usr/share/ubispot/handler.uc /cpd=/usr/share/ubispot/handler-cpd.uc /hotspot=/usr/share/ubispot/handler.uc /cpd=/usr/share/ubispot/handler-cpd.uc /hotspot=/usr/share/ubispot/handler.uc /cpd=/usr/share/ubispot/handler-cpd.uc /hotspot=/usr/share/ubispot/handler.uc /cpd=/usr/share/ubispot/handler-cpd.uc /hotspot=/usr/share/ubispot/handler.uc /cpd=/usr/share/ubispot/handler-cpd.uc /hotspot=/usr/share/ubispot/handler.uc /cpd=/usr/share/ubispot/handler-cpd.uc'
	option redirect_https '0'
	option max_requests '5'
	option error_page '/cpd'

