<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ubispot Deployment Diff - QEMU OpenWRT VM</title>
    <link rel="stylesheet" href="../assets/dashboard.css">
    <style>
        .diff-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .diff-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .diff-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .change-category {
            background: white;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        .category-header {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            font-size: 1.1em;
        }
        .change-item {
            margin-bottom: 15px;
            border-radius: 6px;
            overflow: hidden;
            border-left: 3px solid #e9ecef;
        }
        .change-header {
            background: #e9ecef;
            padding: 10px 15px;
            font-weight: bold;
            border-bottom: 1px solid #dee2e6;
        }
        .change-content {
            padding: 15px;
        }
        .removed { color: #dc3545; background-color: #f8d7da; }
        .added { color: #155724; background-color: #d4edda; }
        .modified { color: #856404; background-color: #fff3cd; }
        .unchanged { color: #6c757d; }
        .line-number {
            display: inline-block;
            width: 40px;
            text-align: right;
            margin-right: 10px;
            color: #6c757d;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
        }
        .impact-high { border-left-color: #e74c3c; }
        .impact-medium { border-left-color: #f39c12; }
        .impact-low { border-left-color: #27ae60; }
        .deployment-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }
        .badge-ubispot { background: #3498db; color: white; }
        .badge-captive { background: #e67e22; color: white; }
        .badge-security { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <div class="diff-container">
        <header class="diff-header">
            <h1>üöÄ ubispot Deployment Configuration Diff</h1>
            <nav class="breadcrumb">
                <a href="../device-QEMU OpenWRT VM.html">‚Üê Back to QEMU OpenWRT VM Dashboard</a>
            </nav>
            <div style="margin-top: 15px;">
                <h2>QEMU OpenWRT VM: pre-ubispot-deployment ‚Üí post-ubispot-deployment</h2>
                <p style="color: #666; margin: 5px 0;">
                    <strong>Before:</strong> 2025-07-01T16:17:23.256Z (pre-ubispot-deployment)<br>
                    <strong>After:</strong> 2025-07-01T16:19:21.801Z (post-ubispot-deployment)<br>
                    <strong>Deployment:</strong> <code>./scripts/run-deploy.sh 192.168.11.2 safe-merge --target default --no-confirm</code>
                </p>
            </div>
        </header>

        <div class="diff-summary">
            <h3>üìä ubispot Deployment Summary</h3>
            <div class="diff-stats">
                <div class="stat added">+6 sections added</div>
                <div class="stat removed">-8 sections removed</div>
                <div class="stat modified">~29 configuration changes</div>
            </div>
            <p><strong>Packages modified:</strong> 5 (dhcp, firewall, network, ubispot, uhttpd)</p>
            <p><strong>Deployment result:</strong> ‚úÖ Applied 5 changes successfully</p>
            <p><strong>Safety measures:</strong> ‚úÖ Backup created, network preserved, services not restarted</p>
        </div>

        <div class="change-category impact-high">
            <div class="category-header">
                üî• Firewall Configuration - Captive Portal Security
                <span class="deployment-badge badge-security">SECURITY</span>
            </div>
            <div style="padding: 20px;">
                <div class="change-item">
                    <div class="change-header">üìã New Firewall Rules for Captive Portal</div>
                    <div class="change-content">
                        <h4>Added Sections:</h4>
                        <pre><span class="added">+ cfg04dc81 - Captive portal traffic rule
+ cfg03dc81 - User authentication rule  
+ cfg10dc81 - DNS redirect rule
+ cfg02b57b - HTTP redirect rule
+ cfg01e63d - HTTPS traffic rule
+ cfg11ad58 - Captive zone forwarding</span></pre>
                        
                        <h4>Modified Captive Configuration:</h4>
                        <pre><span class="modified">~ Section: captive
    network: [captive] ‚Üí captive
~ Section: captive_rule14  
    proto: [udp, tcp] ‚Üí udp tcp
~ Section: captive_ipset1
    match: [src_mac] ‚Üí src_mac
~ Section: captive_ipset2  
    match: [dest_ip] ‚Üí dest_ip
    entry: [10.0.0.1, 10.8.0.1] ‚Üí 10.0.0.1 10.8.0.1</span></pre>
                        
                        <p style="margin-top: 15px; color: #666;">
                            <strong>Impact:</strong> Configured comprehensive firewall rules for captive portal operation, 
                            including traffic redirection, user authentication, and network isolation.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="change-category impact-high">
            <div class="category-header">
                üåê UHTTPd Web Server - Captive Portal Interface
                <span class="deployment-badge badge-ubispot">UBISPOT</span>
            </div>
            <div style="padding: 20px;">
                <div class="change-item">
                    <div class="change-header">üîß Web Server Reconfiguration</div>
                    <div class="change-content">
                        <h4>Main HTTP Configuration:</h4>
                        <pre><span class="modified">~ Section: main
    listen_https: [0.0.0.0:443, [::]:443] ‚Üí 0.0.0.0:443 [::]:443
    lua_prefix: [/cgi-bin/luci=/usr/lib/lua/luci/sgi/uhttpd.lua] ‚Üí /cgi-bin/luci=/usr/lib/lua/luci/sgi/uhttpd.lua
    listen_http: [192.168.11.2:8080] ‚Üí 192.168.11.2:8080</span></pre>

                        <h4>ubispot Captive Portal Handlers:</h4>
                        <pre><span class="modified">~ Section: ubispot
    listen_http: [10.0.0.1:80] ‚Üí 10.0.0.1:80
    ucode_prefix: [/hotspot=/usr/share/ubispot/handler.uc, /cpd=/usr/share/ubispot/handler-cpd.uc] 
                  ‚Üí /hotspot=/usr/share/ubispot/handler.uc /cpd=/usr/share/ubispot/handler-cpd.uc</span></pre>

                        <h4>User Authentication Management (UAM):</h4>
                        <pre><span class="modified">~ Section: uam3990
    listen_http: [0.0.0.0:3990] ‚Üí 0.0.0.0:3990  
    ucode_prefix: [/logon=/usr/share/ubispot/handler-uam.uc, /logoff=/usr/share/ubispot/handler-uam.uc, /logout=/usr/share/ubispot/handler-uam.uc]
                  ‚Üí /logon=/usr/share/ubispot/handler-uam.uc /logoff=/usr/share/ubispot/handler-uam.uc /logout=/usr/share/ubispot/handler-uam.uc</span></pre>
                        
                        <p style="margin-top: 15px; color: #666;">
                            <strong>Impact:</strong> Configured complete captive portal web interface with user authentication endpoints,
                            hotspot detection, and captive portal detection (CPD) handlers.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="change-category impact-medium">
            <div class="category-header">
                üåç Network Configuration - Interface Updates
                <span class="deployment-badge badge-captive">CAPTIVE</span>
            </div>
            <div style="padding: 20px;">
                <div class="change-item">
                    <div class="change-header">üîó Network Interface Optimization</div>
                    <div class="change-content">
                        <h4>Bridge Configuration:</h4>
                        <pre><span class="modified">~ Section: device_lan
    ports: [eth0] ‚Üí eth0</span></pre>

                        <h4>DNS Configuration Updates:</h4>
                        <pre><span class="modified">~ Section: lan
    dns: [192.168.11.1] ‚Üí 192.168.11.1
~ Section: wan  
    dns: [192.168.12.1] ‚Üí 192.168.12.1
~ Section: captive
    dns: [10.0.0.1] ‚Üí 10.0.0.1</span></pre>
                        
                        <p style="margin-top: 15px; color: #666;">
                            <strong>Impact:</strong> Optimized network configuration for captive portal operation, 
                            ensuring proper DNS resolution for authenticated and unauthenticated users.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="change-category impact-low">
            <div class="category-header">
                üì° DHCP Configuration - Router Advertisement
            </div>
            <div style="padding: 20px;">
                <div class="change-item">
                    <div class="change-header">‚öôÔ∏è IPv6 Router Advertisement</div>
                    <div class="change-content">
                        <pre><span class="modified">~ Section: lan
    ra_flags: [managed-config, other-config] ‚Üí managed-config other-config</span></pre>
                        
                        <p style="margin-top: 15px; color: #666;">
                            <strong>Impact:</strong> Minor formatting optimization for IPv6 router advertisement flags.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="change-category impact-medium">
            <div class="category-header">
                üì± ubispot Service Configuration
                <span class="deployment-badge badge-ubispot">UBISPOT</span>
            </div>
            <div style="padding: 20px;">
                <div class="change-item">
                    <div class="change-header">üîß Captive Portal Service</div>
                    <div class="change-content">
                        <p>ubispot configuration was optimized during the merge process:</p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>‚úÖ Authentication server: 10.8.0.1:1812</li>
                            <li>‚úÖ Accounting server: 10.8.0.1:1813</li>
                            <li>‚úÖ UAM server: http://10.8.0.1:8080</li>
                            <li>‚úÖ Captive interface: configured</li>
                            <li>‚úÖ Session timeout: 0 (unlimited)</li>
                            <li>‚úÖ Idle timeout: 600 seconds</li>
                        </ul>
                        
                        <p style="color: #666; margin-top: 15px;">
                            <strong>Impact:</strong> Core captive portal service maintained existing configuration with format optimizations.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="change-category">
            <div class="category-header">
                ‚öôÔ∏è System State Changes
            </div>
            <div style="padding: 20px;">
                <div class="change-item">
                    <div class="change-header">üìà Runtime Changes</div>
                    <div class="change-content">
                        <h4>Normal System State Updates:</h4>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>Uptime:</strong> System runtime progression</li>
                            <li><strong>Memory usage:</strong> Deployment process memory allocation</li>
                            <li><strong>Disk usage:</strong> Framework installation temporary files</li>
                            <li><strong>Load average:</strong> CPU activity during deployment</li>
                        </ul>
                        <p style="color: #666; margin-top: 10px;">
                            <em>Note: These are expected runtime variations during the deployment process.</em>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <footer style="margin-top: 30px; padding: 20px; text-align: center; color: #666; border-top: 1px solid #dee2e6;">
            <p>
                üöÄ <strong>ubispot Deployment Completed Successfully</strong><br>
                Generated by UCI Device Orchestrator ‚Ä¢ <span id="current-time"></span><br>
                <small>Deployment logs: /home/s2/cc1/scripts/../logs/deploy-20250701-161907-192.168.11.2.log</small>
            </p>
        </footer>
    </div>

    <script>
        document.getElementById('current-time').textContent = new Date().toLocaleString();
    </script>
</body>
</html>