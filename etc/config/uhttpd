# uspot Captive Portal uhttpd Configuration
# OpenWRT 23.05+ UCI format
# Based on uspot documentation requirements

# Main uspot web interface and CPD/UAM handlers
config uhttpd 'uspot'
	list listen_http '10.0.0.1:80'
	option redirect_https '0'
	option max_requests '5'
	option no_dirlists '1'
	option home '/www-uspot'
	list ucode_prefix '/hotspot=/usr/share/uspot/handler.uc'
	list ucode_prefix '/cpd=/usr/share/uspot/handler-cpd.uc'
	option error_page '/cpd'
	# TLS support for RFC8908 CapPort API
	list listen_https '10.0.0.1:443'
	option cert '/usr/share/certs/captive.pem'
	option key '/usr/share/certs/captive.key'
	# RFC8908 Captive Portal API support
	list ucode_prefix '/api=/usr/share/uspot/handler-api.uc'

# RADIUS UAM authentication server
config uhttpd 'uam3990'
	list listen_http '10.0.0.1:3990'
	option redirect_https '0'
	option max_requests '5'
	option no_dirlists '1'
	option home '/www-uspot'
	list ucode_prefix '/logon=/usr/share/uspot/handler-uam.uc'
	list ucode_prefix '/logoff=/usr/share/uspot/handler-uam.uc'
	list ucode_prefix '/logout=/usr/share/uspot/handler-uam.uc'

# Modified main uhttpd instance to avoid conflicts
# This restricts the default uhttpd to LAN interface only
config uhttpd 'main'
	list listen_http '192.168.1.1:80'
	list listen_https '192.168.1.1:443'
	option home '/www'
	option rfc1918_filter '1'
	option max_requests '3'
	option max_connections '100'
	option cert '/etc/uhttpd.crt'
	option key '/etc/uhttpd.key'
	option cgi_prefix '/cgi-bin'
	option script_timeout '60'
	option network_timeout '30'
	option http_keepalive '20'
	option tcp_keepalive '1'
	option ubus_prefix '/ubus'