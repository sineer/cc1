config system
	option hostname 'OpenWrt-Ubispot'
	option timezone 'UTC'
	option ttylogin '0'
	option log_size '64'
	option urandom_seed '0'

config timeserver 'ntp'
	option enabled '1'
	option enable_server '0'
	list server '0.openwrt.pool.ntp.org'
	list server '1.openwrt.pool.ntp.org'
	list server '2.openwrt.pool.ntp.org'
	list server '3.openwrt.pool.ntp.org'

config network
	option interface 'loopback'
	option proto 'static'
	option ipaddr '127.0.0.1'
	option netmask '255.0.0.0'

config interface 'lan'
	option type 'bridge'
	option ifname 'eth0'
	option proto 'static'
	option ipaddr '192.168.1.1'
	option netmask '255.255.255.0'
	option ip6assign '60'

config interface 'wan'
	option ifname 'eth1'
	option proto 'dhcp'

config interface 'wan6'
	option ifname 'eth1'
	option proto 'dhcpv6'

config interface 'captive'
	option proto 'static'
	option ipaddr '10.0.0.1'
	option netmask '255.255.255.0'
	option type 'bridge'
	option ifname 'wlan0'

config dhcp 'dnsmasq'
	option domainneeded '1'
	option boguspriv '1'
	option filterwin2k '0'
	option localise_queries '1'
	option rebind_protection '1'
	option rebind_localhost '1'
	option local '/lan/'
	option domain 'lan'
	option expandhosts '1'
	option nonegcache '0'
	option authoritative '1'
	option readethers '1'
	option leasefile '/tmp/dhcp.leases'
	option resolvfile '/tmp/resolv.conf.d/resolv.conf.auto'
	option nonwildcard '1'
	option localservice '1'
	option ednspacket_max '1232'

config dhcp 'lan'
	option interface 'lan'
	option start '100'
	option limit '150'
	option leasetime '12h'
	option dhcpv4 'server'
	option dhcpv6 'server'
	option ra 'server'

config dhcp 'wan'
	option interface 'wan'
	option ignore '1'

config dhcp 'captive'
	option interface 'captive'
	option start '10'
	option limit '100'
	option leasetime '1h'
	option dhcpv4 'server'

config dhcp 'captive_domain1'
	option name 'captive.local'
	option ip '10.0.0.1'

config firewall
	option syn_flood '1'
	option input 'ACCEPT'
	option output 'ACCEPT'
	option forward 'REJECT'

config zone
	option name 'lan'
	option network 'lan'
	option input 'ACCEPT'
	option output 'ACCEPT'
	option forward 'ACCEPT'

config zone
	option name 'wan'
	option network 'wan wan6'
	option input 'REJECT'
	option output 'ACCEPT'
	option forward 'REJECT'
	option masq '1'
	option mtu_fix '1'

config zone
	option name 'captive'
	option network 'captive'
	option input 'ACCEPT'
	option output 'ACCEPT'
	option forward 'REJECT'

config forwarding
	option src 'lan'
	option dest 'wan'

config rule
	option name 'Allow-DHCP-Renew'
	option src 'wan'
	option proto 'udp'
	option dest_port '68'
	option target 'ACCEPT'
	option family 'ipv4'

config rule
	option name 'Allow-Ping'
	option src 'wan'
	option proto 'icmp'
	option icmp_type 'echo-request'
	option family 'ipv4'
	option target 'ACCEPT'

config rule 'captive_rule10'
	option name 'Captive-Portal-HTTP'
	option src 'captive'
	option proto 'tcp'
	option dest_port '80'
	option target 'ACCEPT'

config rule 'captive_rule11'
	option name 'Captive-Portal-HTTPS'
	option src 'captive'
	option proto 'tcp'
	option dest_port '443'
	option target 'ACCEPT'

config rule 'captive_rule12'
	option name 'Captive-Portal-DNS'
	option src 'captive'
	option proto 'udp'
	option dest_port '53'
	option target 'ACCEPT'

config rule 'captive_rule13'
	option name 'Captive-Portal-DHCP'
	option src 'captive'
	option proto 'udp'
	option dest_port '67'
	option target 'ACCEPT'

config rule 'captive_rule14'
	option name 'Captive-Portal-NTP'
	option src 'captive'
	option proto 'udp'
	option dest_port '123'
	option target 'ACCEPT'

config rule 'captive_rule15'
	option name 'Captive-Portal-Auth'
	option src 'captive'
	option proto 'tcp'
	option dest_port '3990'
	option target 'ACCEPT'

config rule 'captive_rule16'
	option name 'Captive-Portal-Radius'
	option src 'captive'
	option proto 'udp'
	option dest_port '1812'
	option target 'ACCEPT'

config redirect 'captive_redirect1'
	option name 'Captive-Portal-Redirect'
	option src 'captive'
	option proto 'tcp'
	option src_dport '80'
	option dest_ip '10.0.0.1'
	option dest_port '3990'
	option target 'DNAT'

config ipset 'captive_ipset1'
	option name 'captive_users'
	option match 'src_ip'
	option storage 'hash'
	option timeout '3600'

config ipset 'captive_ipset2'
	option name 'captive_allowed'
	option match 'src_ip'
	option storage 'hash'

config rule 'captive'
	option name 'Captive-Portal-Bypass'
	option src 'captive'
	option ipset 'captive_allowed'
	option target 'ACCEPT'

config ubispot 'captive'
	option enabled '1'
	option interface 'captive'
	option portal_url 'http://10.0.0.1:3990/portal'
	option auth_server 'http://10.0.0.1:3990/auth'
	option radius_server '127.0.0.1'
	option radius_port '1812'
	option radius_secret 'testing123'
	option session_timeout '3600'
	option idle_timeout '900'
	option nas_identifier 'OpenWrt-Ubispot'
	option location_id 'location1'
	option location_name 'Test Location'

config uhttpd 'ubispot'
	option home '/usr/share/ubispot/www'
	option listen_http '0.0.0.0:3990'
	option listen_https '0.0.0.0:3991'
	option cert '/etc/ssl/certs/ubispot.crt'
	option key '/etc/ssl/private/ubispot.key'
	option cgi_prefix '/cgi-bin'
	option script_timeout '60'
	option network_timeout '30'
	option http_keepalive '20'
	option tcp_keepalive '1'

config uhttpd 'uam3990'
	option home '/usr/share/ubispot/portal'
	option listen_http '0.0.0.0:3990'
	option cgi_prefix '/cgi-bin'
	option script_timeout '60'
	option network_timeout '30'
	option http_keepalive '20'
	option tcp_keepalive '1'
	option ubus_prefix '/ubus'